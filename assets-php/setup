#!/bin/sh

ver="${1:-7}"

modules_common="
apache2
bcmath
brotli
bz2
calendar
common
ctype
curl
dba
dom
embed
enchant
exif
ffi
fileinfo
ftp
gd
gettext
gmp
iconv
imap
intl
ldap
litespeed
mbstring
mysqli
mysqlnd
odbc
opcache
openssl
pcntl
pdo
pdo_dblib
pdo_mysql
pdo_odbc
pdo_pgsql
pdo_sqlite
pgsql
phar
posix
pspell
session
shmop
simplexml
snmp
soap
sockets
sodium
sqlite3
sysvmsg
sysvsem
sysvshm
tideways_xhprof
tidy
tokenizer
xml
xmlreader
xmlwriter
xsl
zip
"

modules_php7="
json
static
xmlrpc
"

modules_php8="
"

all_modules="$modules_common
$(eval echo \"\${modules_php$ver}\")
"

apk --no-cache add \
	php${ver} $(echo "$all_modules" | sed -e "/^#/d" -e "/^$/d" -e "s/^/php$ver-/")

# Run smoketest
httpd -t -T

rm "$0"
